version: '3.3'

services:
  syg-backend:
    container_name: syg-backend
    build:
      context: ../../../
      dockerfile: ./SYG-bootstrap/src/docker/backend.Dockerfile
    ports:
      - 8080:8080
    networks:
      syg:
        aliases:
          - syg-backend
      
  syg-db:
    container_name: syg-db
    build:
      context: ../../../
      dockerfile: ./SYG-bootstrap/src/docker/database-mysql.Dockerfile
    ports:
      - 3306:3306
    volumes:
      - ../sql/scheme.sql:/docker-entrypoint-initdb.d/init.sql
    restart: always
    networks:
      syg:
        aliases:
          - syg-db
          
  syg-keycloak:
    container_name: syg-keycloak
    image: quay.io/keycloak/keycloak:24.0.1
    ports:
      - 8090:8080
    volumes:
      - ./keycloak/imports/realm.json:/opt/keycloak/data/import/realm.json
    environment:
      - KEYCLOAK_ADMIN=admin
      - KEYCLOAK_ADMIN_PASSWORD=admin
    command:
      - start-dev
      - --import-realm
    networks:
      syg:
        aliases:
          - syg-keycloak

  prometheus:
    container_name: prometheus
    image: prom/prometheus
    ports:
      - 9090:9090
    volumes:
      - ../prometheus/prometheus.yml:/etc/prometheus/prometheus.yml

  grafana:
    container_name: grafana
    image: grafana/grafana
    ports:
      - 3200:3000
    restart: unless-stopped
    volumes:
      - ../grafana/provisioning/datasources:/etc/grafana/provisioning/datasources
          
  syg-frontend:
    build:
      context: ../../../../
      dockerfile: ./syg-frontend/frontend.Dockerfile
    ports:
      - 3200:3000
    networks:
      syg:
        aliases:
          - syg-frontend

networks:
    syg:
      driver: bridge