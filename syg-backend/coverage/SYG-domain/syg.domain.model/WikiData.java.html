<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>WikiData.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">SYG_bootstrap</a> &gt; <a href="../index.html" class="el_bundle">SYG-domain</a> &gt; <a href="index.source.html" class="el_package">syg.domain.model</a> &gt; <span class="el_source">WikiData.java</span></div><h1>WikiData.java</h1><pre class="source lang-java linenums">package syg.domain.model;

import java.util.ArrayList;
import java.util.List;
import java.util.Random;

import org.eclipse.rdf4j.query.BindingSet;
import org.eclipse.rdf4j.query.TupleQuery;
import org.eclipse.rdf4j.query.TupleQueryResult;
import org.eclipse.rdf4j.repository.Repository;
import org.eclipse.rdf4j.repository.RepositoryConnection;
import org.eclipse.rdf4j.repository.RepositoryException;
import org.eclipse.rdf4j.repository.sparql.SPARQLRepository;
import org.springframework.stereotype.Component;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

<span class="pc bpc" id="L20" title="27 of 30 branches missed.">@Data</span>
<span class="nc" id="L21">@AllArgsConstructor</span>
<span class="fc" id="L22">@NoArgsConstructor</span>
@Component
public class WikiData {

	public static final String WIKIDATA_URL = &quot;https://query.wikidata.org/sparql&quot;;

	public static final String WIKIDATA_QUERY = &quot;SELECT DISTINCT (strafter(str(?item), \&quot;http://www.wikidata.org/entity/\&quot;) AS ?entityId) ?label ?description WHERE {\n&quot;
			+ &quot;  ?item wdt:P31 wd:%s .\n&quot; + &quot;  ?item rdfs:label ?label .\n&quot;
			+ &quot;  ?item schema:description ?description .\n&quot;
			+ &quot;  FILTER(LANG(?label) = \&quot;es\&quot; &amp;&amp; LANG(?description) = \&quot;es\&quot;)\n&quot; + &quot;	} LIMIT 50&quot;;
	
<span class="fc" id="L33">	private String id;</span>

<span class="fc" id="L35">	private String description;</span>

<span class="fc" id="L37">	private String response;</span>

	/**
	 * Ejecuta la query de búsqueda de preguntas por categoria
	 * 
	 * @param sparqlQuery
	 * @return
	 */
	public List&lt;WikiData&gt; executeSparqlQuery(String sparqlQuery) {
<span class="nc" id="L46">		List&lt;WikiData&gt; resultList = new ArrayList&lt;&gt;();</span>

<span class="nc" id="L48">		Repository repository = new SPARQLRepository(WIKIDATA_URL);</span>
<span class="nc" id="L49">		RepositoryConnection connection = null;</span>

		try {
<span class="nc" id="L52">			repository.init();</span>
<span class="nc" id="L53">			connection = repository.getConnection();</span>
<span class="nc" id="L54">			TupleQuery query = connection.prepareTupleQuery(sparqlQuery);</span>
<span class="nc" id="L55">			try (TupleQueryResult result = query.evaluate()) {</span>
<span class="nc bnc" id="L56" title="All 2 branches missed.">				while (result.hasNext()) {</span>
<span class="nc" id="L57">					BindingSet bindingSet = result.next();</span>
<span class="nc" id="L58">					String entityId = bindingSet.getValue(&quot;entityId&quot;).stringValue();</span>
<span class="nc" id="L59">					String description = bindingSet.getValue(&quot;description&quot;).stringValue();</span>
<span class="nc" id="L60">					String response = bindingSet.getValue(&quot;label&quot;).stringValue();</span>
<span class="nc" id="L61">					resultList.add(new WikiData(entityId, description, response));</span>
<span class="nc" id="L62">				}</span>
			}
<span class="nc" id="L64">		} catch (RepositoryException e) {</span>
<span class="nc" id="L65">			throw new RepositoryException();</span>
		} finally {
<span class="nc bnc" id="L67" title="All 2 branches missed.">			if (connection != null) {</span>
<span class="nc" id="L68">				connection.close();</span>
			}
<span class="nc" id="L70">			repository.shutDown();</span>
		}

<span class="nc" id="L73">		return resultList;</span>
	}

	/**
	 * Genéra números aleatorios para el índice de las preguntas incorrectas de wikidata.
	 * Nunca pueden coincidir con las correcta
	 * 
	 * @param size El tamaño de la lista de preguntas
	 * @param excludedIndex El indice excluido para que no coincida con la respuesta correcta
	 * @param count El número de respuestas incorrectas
	 * @return
	 */
	public List&lt;Integer&gt; generateUniqueRandomIndex(int size, int excludedIndex, int count) {
<span class="nc bnc" id="L86" title="All 2 branches missed.">		if (count &gt; size - 1) {</span>
<span class="nc" id="L87">			throw new IllegalArgumentException(&quot;The number of numbers requested is greater than the available range.&quot;);</span>
		}

<span class="nc" id="L90">		List&lt;Integer&gt; indices = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L91">		Random random = new Random();</span>

<span class="nc bnc" id="L93" title="All 2 branches missed.">		for (int i = 0; i &lt; count; i++) {</span>
			int randomIndex;
			do {
<span class="nc" id="L96">				randomIndex = random.nextInt(size);</span>
<span class="nc bnc" id="L97" title="All 4 branches missed.">			} while (randomIndex == excludedIndex || indices.contains(randomIndex));</span>

<span class="nc" id="L99">			indices.add(randomIndex);</span>
		}

<span class="nc" id="L102">		return indices;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>